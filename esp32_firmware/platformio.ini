[platformio]
default_envs = t-bao
src_dir = src
boards_dir = boards

[env]
check_tool = clangtidy  ; Enable clang-tidy linter
lib_extra_dirs = ${PROJECT_DIR} 
lib_ignore = lib_deps
platform = espressif32@6.7.0
framework = arduino
upload_speed = 921600
monitor_speed = 115200
build_flags =
    -DBOARD_HAS_PSRAM
    -DDISABLE_ALL_LIBRARY_WARNINGS
    ; Enable -DARDUINO_USB_CDC_ON_BOOT will start printing and wait for terminal access during startup
    -DARDUINO_USB_CDC_ON_BOOT=1
    ; USB host example must disable usb cdc
    ; Enable -UARDUINO_USB_CDC_ON_BOOT will turn off printing and will not block when using the battery
    ; -UARDUINO_USB_CDC_ON_BOOT
    -DCORE_DEBUG_LEVEL=1
    ; Use C++20 standard for advanced features
    -std=gnu++2a
    ; T-Bao specific flags
    -DT_BAO_BOARD
    -DWIFI_ENABLED
    -DWEBSOCKET_ENABLED

build_unflags =
    -std=gnu++11

monitor_filters =
	default
	esp32_exception_decoder

lib_deps = 
    ; Core networking libraries
    arduino-libraries/ArduinoHttpClient@^0.6.1
    links2004/WebSockets@^2.6.1
    ArduinoJson@^7.0.4
    
    ; T-Bao hardware support
    ; Note: Add specific T-Bao libraries when available
    ; For now using generic ESP32 libraries
    
    ; Display support (ST7789)
    ; bodmer/TFT_eSPI@^2.5.43
    
    ; Camera support (OV2640)
    ; espressif/esp32-camera@^2.0.4
    
    ; Audio support (I2S)
    ; ESP32-audioI2S
    
    ; Sensor support
    ; adafruit/Adafruit MPU6050@^2.2.6
    
    ; Power management
    ; lewisxhe/XPowersLib@^0.2.2
    
    ; File system support
    FS
    SPIFFS
    SD
    
    ; Time management
    arduino-libraries/NTPClient@^3.2.1
    
    ; Button handling
    ; bxparks/AceButton@^1.10.1

board_build.filesystem = spiffs

; ===================================
; === T-Bao Device ===
; ===================================
[env:t-bao]
extends = env
board = esp32dev  ; Use generic ESP32 board until T-Bao specific board available
build_flags =
    ${env.build_flags}
    ; T-Bao specific pin definitions
    -DCAMERA_MODEL_TBAO
    -DLCD_ST7789
    -DAUDIO_I2S_ENABLED
    -DSENSOR_MPU6050_ENABLED

; ===================================
; === Testing ===
; ===================================
[env:test]
platform = native
build_flags = 
    -std=c++17
    -DUNIT_TEST
    -DSIMULATION_MODE
    -I include
    -I src
    -I test/mocks
lib_deps =
    throwtheswitch/Unity@^2.5.2
lib_compat_mode = off

; ===================================
; === Virtual Device Testing ===
; ===================================
[env:qemu_esp32]
platform = espressif32
board = esp32dev
framework = arduino
test_framework = unity
platform_packages =
    platformio/tool-qemu-xtensa@~1.0.0
test_testing_command =
    ${platformio.packages_dir}/tool-qemu-xtensa/bin/qemu-system-xtensa -machine esp32 -nographic -serial mon:stdio -kernel ${PROJECT_BUILD_DIR}/${PIOENV}/firmware.elf
